<!DOCTYPE html>
<html lang="et">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bayesi kalkulaator: kordustesti ja viiruse levimuse mõju</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            line-height: 1.6;
            padding: 20px;
            background-color: #f8f9fa;
            color: #212529;
            display: flex;
            justify-content: center;
        }
        .container {
            background-color: #fff;
            padding: 25px 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            max-width: 700px;
            width: 100%;
        }
        h1, h2 {
            text-align: center;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .intro {
            font-size: 0.95em;
            text-align: center;
            margin-bottom: 25px;
            color: #495057;
        }
        .controls {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        .input-group {
            display: grid;
            grid-template-columns: 150px 1fr 60px;
            align-items: center;
            gap: 15px;
        }
        label {
            font-weight: bold;
        }
        input[type="range"] {
            -webkit-appearance: none; appearance: none;
            width: 100%; height: 8px;
            background: #dee2e6; border-radius: 5px;
            outline: none; opacity: 0.9;
            transition: opacity .2s;
        }
        input[type="range"]:hover { opacity: 1; }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 20px; height: 20px;
            background: #007bff; cursor: pointer; border-radius: 50%;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px; height: 20px;
            background: #007bff; cursor: pointer; border-radius: 50%;
        }
        .value-display { font-weight: bold; color: #007bff; text-align: right; }
        input[type="number"] { padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 1em; text-align: right; }
        .button-container { text-align: center; }
        button {
            padding: 12px 30px; font-size: 1.1em; font-weight: bold;
            border: none; border-radius: 5px; cursor: pointer;
            background-color: #28a745; color: white;
            transition: background-color 0.3s ease;
        }
        button:hover { background-color: #218838; }
        #results {
            margin-top: 30px; padding: 20px;
            background-color: #f8f9fa; border-radius: 5px;
            border: 1px solid #e9ecef;
            display: none; /* Algselt peidetud */
        }
        #results p { margin: 10px 0; font-size: 1.05em; }
        #results span { font-weight: bold; }
        .conclusion {
            margin-top: 20px !important; padding: 15px;
            background-color: #e9ecef; border-left: 5px solid #007bff;
            font-weight: bold; font-size: 1.1em !important;
        }
        .conclusion.second-test {
            background-color: #d4edda; /* Rohekas taust */
            border-left-color: #155724; /* Tume roheline */
        }
        .parameters-info { margin-top: 25px; font-size: 0.9em; color: #6c757d; }
        .parameters-info p { margin: 5px 0; }
    </style>
</head>
<body>

<div class="container">
    <h1>Bayesi kalkulaator: kordustesti ja viiruse levimuse mõju</h1>
    <p class="intro">See tööriist näitlikustab, kuidas testi usaldusväärsus sõltub haiguse tegelikust levikust karjas (prevalentsist). Muuda parameetreid, et näha, kuidas sama test käitub haruldase haiguse ja laialdase epideemia korral.</p>

    <div class="controls">
        <div class="input-group">
            <label for="prevalence">Haiguse levik:</label>
            <input type="range" id="prevalence" min="0.1" max="20" value="0.1" step="0.1">
            <span id="prevalenceValue" class="value-display">0.1%</span>
        </div>
        <div class="input-group">
            <label for="sensitivity">Testi tundlikkus:</label>
            <input type="range" id="sensitivity" min="80" max="100" value="99" step="0.1">
            <span id="sensitivityValue" class="value-display">99.0%</span>
        </div>
        <div class="input-group">
            <label for="specificity">Testi spetsiifilisus:</label>
            <input type="range" id="specificity" min="80" max="100" value="99" step="0.1">
            <span id="specificityValue" class="value-display">99.0%</span>
        </div>
        <div class="input-group">
            <label for="population">Karja suurus:</label>
            <input type="number" id="population" value="10000" step="100">
            <span>siga</span>
        </div>
    </div>

    <div class="button-container">
        <button id="calculateBtn">Arvuta</button>
    </div>

    <div id="results">
        <h2>Tulemuste tõlgendus</h2>
        <div id="summary"></div>
        <p class="conclusion" id="firstTestConclusion"></p>
        <p class="conclusion second-test" id="secondTestConclusion"></p>
    </div>

    <div class="parameters-info">
        <p><b>Haiguse levik (prevalents):</b> Tõenäosus, et juhuslikult valitud siga karjast on haige.</p>
        <p><b>Testi tundlikkus:</b> Tõenäosus, et haige siga saab positiivse testitulemuse.</p>
        <p><b>Testi spetsiifilisus:</b> Tõenäosus, et terve siga saab negatiivse testitulemuse.</p>
    </div>
</div>

<script>
    // --- DOM ELEMENDID ---
    const prevalenceSlider = document.getElementById('prevalence');
    const sensitivitySlider = document.getElementById('sensitivity');
    const specificitySlider = document.getElementById('specificity');
    const populationInput = document.getElementById('population');

    const prevalenceValue = document.getElementById('prevalenceValue');
    const sensitivityValue = document.getElementById('sensitivityValue');
    const specificityValue = document.getElementById('specificityValue');

    const calculateBtn = document.getElementById('calculateBtn');
    const resultsDiv = document.getElementById('results');
    const summaryDiv = document.getElementById('summary');
    const firstTestConclusionP = document.getElementById('firstTestConclusion');
    const secondTestConclusionP = document.getElementById('secondTestConclusion');

    // --- SÜNDMUSTE KUULAJAD ---
    function updateSliderValue(slider, display) {
        display.textContent = `${parseFloat(slider.value).toFixed(1)}%`;
    }
    
    prevalenceSlider.addEventListener('input', () => updateSliderValue(prevalenceSlider, prevalenceValue));
    sensitivitySlider.addEventListener('input', () => updateSliderValue(sensitivitySlider, sensitivityValue));
    specificitySlider.addEventListener('input', () => updateSliderValue(specificitySlider, specificityValue));
    
    calculateBtn.addEventListener('click', calculate);

    // --- ALGSEADISTUS ---
    // Käivitame korra lehe laadimisel, et väärtused oleksid näha
    updateSliderValue(prevalenceSlider, prevalenceValue);
    updateSliderValue(sensitivitySlider, sensitivityValue);
    updateSliderValue(specificitySlider, specificityValue);

    // --- ARVUTUSLOOGIKA ---
    function calculate() {
        // Saame väärtused ja teisendame protsendid kümnendmurdudeks
        const prevalence = parseFloat(prevalenceSlider.value) / 100;
        const sensitivity = parseFloat(sensitivitySlider.value) / 100;
        const specificity = parseFloat(specificitySlider.value) / 100;
        const population = parseInt(populationInput.value);

        if (isNaN(population) || population <= 0) {
            alert("Palun sisesta korrektne karja suurus.");
            return;
        }

        // --- OSA 1: ESIMENE TEST (TERVE KARJA PEAL) ---
        const sickPopulation = Math.round(population * prevalence);
        const healthyPopulation = population - sickPopulation;

        const truePositives = Math.round(sickPopulation * sensitivity);
        const falsePositives = Math.round(healthyPopulation * (1 - specificity));

        const totalPositiveTests = truePositives + falsePositives;

        let ppv1 = 0; // Positiivne ennustusväärtus #1
        if (totalPositiveTests > 0) {
            ppv1 = (truePositives / totalPositiveTests);
        }

        // Vormindame esimese osa väljundi
        summaryDiv.innerHTML = `
            <p>Hüpoteetilisest <span>${population.toLocaleString('et-EE')}</span> seast on tegelikult haigeid (levimusega <span>${(prevalence * 100).toFixed(1)}%</span>) umbes <span>${sickPopulation.toLocaleString('et-EE')}</span> ja terveid <span>${healthyPopulation.toLocaleString('et-EE')}</span>.</p>
            <p>Positiivse testitulemuse said kokku <span>${totalPositiveTests.toLocaleString('et-EE')}</span> siga, kellest <b>tegelikult haigeid</b> oli <span>${truePositives.toLocaleString('et-EE')}</span> ja <b>tegelikult terveid</b> (valepositiivsed) oli <span>${falsePositives.toLocaleString('et-EE')}</span>.</p>
        `;
        firstTestConclusionP.textContent = `JÄRELDUS #1: Pärast esimest positiivset testi on tõenäosus, et siga on tegelikult haige, ${(ppv1 * 100).toFixed(1)}%.`;

        // --- OSA 2: TEINE TEST (SAMA POSITIIVSE SEA PEAL) ---
        const priorForSecondTest = ppv1;

        const numerator = sensitivity * priorForSecondTest;
        const denominatorPart2 = (1 - specificity) * (1 - priorForSecondTest);
        const totalProbabilityOfPositiveTest2 = numerator + denominatorPart2;
        
        let ppv2 = 0; // Positiivne ennustusväärtus #2
        if (totalProbabilityOfPositiveTest2 > 0) {
            ppv2 = (numerator / totalProbabilityOfPositiveTest2) * 100;
        }

        secondTestConclusionP.textContent = `JÄRELDUS #2: Kui see sama siga testitakse uuesti ja ka teine test on positiivne, on tema tegeliku haigestumise tõenäosus hüpanud ${(ppv2).toFixed(1)}%-ni.`;
        
        // Muudame tulemuste ploki nähtavaks
        resultsDiv.style.display = 'block';
    }
</script>

</body>

</html>
